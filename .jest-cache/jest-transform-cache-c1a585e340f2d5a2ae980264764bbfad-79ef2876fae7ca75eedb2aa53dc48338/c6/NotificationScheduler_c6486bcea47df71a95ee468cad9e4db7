af0a3e63ed8fdfb5259c0f8896dc7df3
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.NotificationScheduler = void 0;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _types = require("./types");
var _Logger = require("../../utils/Logger");
var NotificationScheduler = exports.NotificationScheduler = function () {
  function NotificationScheduler(notificationService) {
    (0, _classCallCheck2.default)(this, NotificationScheduler);
    this.scheduledNotifications = new Map();
    this.isInitialized = false;
    this.notificationService = notificationService;
  }
  return (0, _createClass2.default)(NotificationScheduler, [{
    key: "initialize",
    value: function () {
      var _initialize = (0, _asyncToGenerator2.default)(function* () {
        try {
          this.isInitialized = true;
          _Logger.logger.info('NotificationScheduler initialized');
        } catch (error) {
          _Logger.logger.error('Failed to initialize NotificationScheduler:', error);
          throw error;
        }
      });
      function initialize() {
        return _initialize.apply(this, arguments);
      }
      return initialize;
    }()
  }, {
    key: "getSmartSchedule",
    value: function () {
      var _getSmartSchedule = (0, _asyncToGenerator2.default)(function* (notification, context) {
        try {
          var now = new Date();
          if (notification.priority === _types.NotificationPriority.URGENT) {
            return {
              scheduledTime: now,
              priority: notification.priority,
              reason: 'Urgent notification - immediate delivery',
              shouldSend: true
            };
          }
          if (this.isInDoNotDisturb(context.preferences.doNotDisturb, now)) {
            if (notification.priority === _types.NotificationPriority.HIGH) {
              var endTime = this.getDoNotDisturbEndTime(context.preferences.doNotDisturb, now);
              return {
                scheduledTime: endTime,
                priority: notification.priority,
                reason: 'Scheduled for after do-not-disturb hours',
                shouldSend: true
              };
            } else {
              return {
                scheduledTime: now,
                priority: notification.priority,
                reason: 'Skipped due to do-not-disturb',
                shouldSend: false
              };
            }
          }
          if (context.userActivity.isFocused && context.preferences.smartScheduling.skipDuringFocus) {
            if (notification.priority === _types.NotificationPriority.HIGH) {
              var endFocusTime = new Date(context.userActivity.lastActivity.getTime() + 60000);
              return {
                scheduledTime: endFocusTime,
                priority: notification.priority,
                reason: 'Scheduled for after focus period',
                shouldSend: true
              };
            } else {
              return {
                scheduledTime: now,
                priority: notification.priority,
                reason: 'Skipped during focus session',
                shouldSend: false
              };
            }
          }
          if (context.userActivity.isInMeeting && context.preferences.smartScheduling.skipDuringMeetings) {
            if (notification.priority === _types.NotificationPriority.HIGH) {
              var afterMeetingTime = new Date(now.getTime() + 300000);
              return {
                scheduledTime: afterMeetingTime,
                priority: notification.priority,
                reason: 'Scheduled for after meeting',
                shouldSend: true
              };
            } else {
              return {
                scheduledTime: now,
                priority: notification.priority,
                reason: 'Skipped during meeting',
                shouldSend: false
              };
            }
          }
          var recentNotifications = context.notificationHistory.filter(function (notification) {
            return notification.timestamp.getTime() > now.getTime() - 300000;
          });
          var categoryPrefs = context.preferences.categories[notification.category];
          if (categoryPrefs != null && categoryPrefs.frequency.maxPerDay) {
            var todayNotifications = context.notificationHistory.filter(function (notification) {
              return notification.timestamp.toDateString() === now.toDateString();
            });
            if (todayNotifications.length >= categoryPrefs.frequency.maxPerDay) {
              return {
                scheduledTime: now,
                priority: notification.priority,
                reason: 'Daily limit reached for this category',
                shouldSend: false
              };
            }
          }
          return {
            scheduledTime: notification.scheduledFor || now,
            priority: notification.priority,
            reason: 'Default scheduling - no restrictions',
            shouldSend: true
          };
        } catch (error) {
          _Logger.logger.error('Failed to get smart schedule:', error);
          return {
            scheduledTime: notification.scheduledFor || new Date(),
            priority: notification.priority,
            reason: 'Fallback to immediate scheduling due to error',
            shouldSend: true
          };
        }
      });
      function getSmartSchedule(_x, _x2) {
        return _getSmartSchedule.apply(this, arguments);
      }
      return getSmartSchedule;
    }()
  }, {
    key: "scheduleTimerNotifications",
    value: function () {
      var _scheduleTimerNotifications = (0, _asyncToGenerator2.default)(function* (timerId, duration) {
        try {
          var completionTime = new Date(Date.now() + duration * 1000);
          var completionNotification = {
            id: `timer_complete_${timerId}`,
            type: 'timer_complete',
            category: 'timers',
            title: 'Focus Session Complete',
            message: 'Great job! Your focus session has ended.',
            priority: _types.NotificationPriority.HIGH,
            userId: 'current_user',
            sessionId: timerId,
            scheduledFor: completionTime,
            createdAt: new Date(),
            updatedAt: new Date()
          };
          yield this.notificationService.scheduleNotification(completionNotification);
          _Logger.logger.info('Timer notifications scheduled', {
            timerId: timerId,
            duration: duration,
            completionTime: completionTime
          });
        } catch (error) {
          _Logger.logger.error('Failed to schedule timer notifications:', error);
        }
      });
      function scheduleTimerNotifications(_x3, _x4) {
        return _scheduleTimerNotifications.apply(this, arguments);
      }
      return scheduleTimerNotifications;
    }()
  }, {
    key: "scheduleMilestoneNotification",
    value: function () {
      var _scheduleMilestoneNotification = (0, _asyncToGenerator2.default)(function* (milestoneId, milestoneType) {
        try {
          var milestoneNotification = {
            id: `milestone_${milestoneId}`,
            type: 'milestone_achievement',
            category: 'achievements',
            title: 'Milestone Achieved!',
            message: `Congratulations! You've achieved a new ${milestoneType} milestone.`,
            priority: _types.NotificationPriority.HIGH,
            userId: 'current_user',
            data: {
              milestoneId: milestoneId,
              milestoneType: milestoneType
            },
            createdAt: new Date(),
            updatedAt: new Date()
          };
          yield this.notificationService.sendImmediateNotification(milestoneNotification);
          _Logger.logger.info('Milestone notification sent', {
            milestoneId: milestoneId,
            milestoneType: milestoneType
          });
        } catch (error) {
          _Logger.logger.error('Failed to schedule milestone notification:', error);
        }
      });
      function scheduleMilestoneNotification(_x5, _x6) {
        return _scheduleMilestoneNotification.apply(this, arguments);
      }
      return scheduleMilestoneNotification;
    }()
  }, {
    key: "scheduleBreakReminder",
    value: function () {
      var _scheduleBreakReminder = (0, _asyncToGenerator2.default)(function* (sessionId, breakDuration, breakTime) {
        try {
          var breakNotification = {
            id: `break_${sessionId}`,
            type: 'break_reminder',
            category: 'reminders',
            title: 'Break Time!',
            message: `Time to take a ${breakDuration}-minute break. You've earned it!`,
            priority: _types.NotificationPriority.NORMAL,
            userId: 'current_user',
            sessionId: sessionId,
            scheduledFor: breakTime,
            createdAt: new Date(),
            updatedAt: new Date()
          };
          yield this.notificationService.scheduleNotification(breakNotification);
          _Logger.logger.info('Break reminder scheduled', {
            sessionId: sessionId,
            breakDuration: breakDuration,
            breakTime: breakTime
          });
        } catch (error) {
          _Logger.logger.error('Failed to schedule break reminder:', error);
        }
      });
      function scheduleBreakReminder(_x7, _x8, _x9) {
        return _scheduleBreakReminder.apply(this, arguments);
      }
      return scheduleBreakReminder;
    }()
  }, {
    key: "cancelScheduledNotification",
    value: function () {
      var _cancelScheduledNotification = (0, _asyncToGenerator2.default)(function* (notificationId) {
        try {
          var timeout = this.scheduledNotifications.get(notificationId);
          if (timeout) {
            clearTimeout(timeout);
            this.scheduledNotifications.delete(notificationId);
            _Logger.logger.info('Scheduled notification cancelled', {
              notificationId: notificationId
            });
          }
        } catch (error) {
          _Logger.logger.error('Failed to cancel scheduled notification:', error);
        }
      });
      function cancelScheduledNotification(_x0) {
        return _cancelScheduledNotification.apply(this, arguments);
      }
      return cancelScheduledNotification;
    }()
  }, {
    key: "getScheduledNotifications",
    value: function () {
      var _getScheduledNotifications = (0, _asyncToGenerator2.default)(function* () {
        return Array.from(this.scheduledNotifications.keys());
      });
      function getScheduledNotifications() {
        return _getScheduledNotifications.apply(this, arguments);
      }
      return getScheduledNotifications;
    }()
  }, {
    key: "dispose",
    value: function () {
      var _dispose = (0, _asyncToGenerator2.default)(function* () {
        try {
          this.scheduledNotifications.forEach(function (timeout) {
            clearTimeout(timeout);
          });
          this.scheduledNotifications.clear();
          this.isInitialized = false;
          _Logger.logger.info('NotificationScheduler disposed');
        } catch (error) {
          _Logger.logger.error('Error disposing NotificationScheduler:', error);
        }
      });
      function dispose() {
        return _dispose.apply(this, arguments);
      }
      return dispose;
    }()
  }, {
    key: "isInDoNotDisturb",
    value: function isInDoNotDisturb(dnd, currentTime) {
      if (!dnd.enabled) return false;
      var now = currentTime;
      var currentMinutes = now.getHours() * 60 + now.getMinutes();
      var _dnd$startTime$split$ = dnd.startTime.split(':').map(Number),
        _dnd$startTime$split$2 = (0, _slicedToArray2.default)(_dnd$startTime$split$, 2),
        startHour = _dnd$startTime$split$2[0],
        startMinute = _dnd$startTime$split$2[1];
      var _dnd$endTime$split$ma = dnd.endTime.split(':').map(Number),
        _dnd$endTime$split$ma2 = (0, _slicedToArray2.default)(_dnd$endTime$split$ma, 2),
        endHour = _dnd$endTime$split$ma2[0],
        endMinute = _dnd$endTime$split$ma2[1];
      var startMinutes = startHour * 60 + startMinute;
      var endMinutes = endHour * 60 + endMinute;
      if (startMinutes > endMinutes) {
        return currentMinutes >= startMinutes || currentMinutes <= endMinutes;
      }
      return currentMinutes >= startMinutes && currentMinutes <= endMinutes;
    }
  }, {
    key: "getDoNotDisturbEndTime",
    value: function getDoNotDisturbEndTime(dnd, currentTime) {
      var _dnd$endTime$split$ma3 = dnd.endTime.split(':').map(Number),
        _dnd$endTime$split$ma4 = (0, _slicedToArray2.default)(_dnd$endTime$split$ma3, 2),
        endHour = _dnd$endTime$split$ma4[0],
        endMinute = _dnd$endTime$split$ma4[1];
      var endTime = new Date(currentTime);
      endTime.setHours(endHour, endMinute, 0, 0);
      if (endTime <= currentTime) {
        endTime.setDate(endTime.getDate() + 1);
      }
      return endTime;
    }
  }]);
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfdHlwZXMiLCJyZXF1aXJlIiwiX0xvZ2dlciIsIk5vdGlmaWNhdGlvblNjaGVkdWxlciIsImV4cG9ydHMiLCJub3RpZmljYXRpb25TZXJ2aWNlIiwiX2NsYXNzQ2FsbENoZWNrMiIsImRlZmF1bHQiLCJzY2hlZHVsZWROb3RpZmljYXRpb25zIiwiTWFwIiwiaXNJbml0aWFsaXplZCIsIl9jcmVhdGVDbGFzczIiLCJrZXkiLCJ2YWx1ZSIsIl9pbml0aWFsaXplIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwibG9nZ2VyIiwiaW5mbyIsImVycm9yIiwiaW5pdGlhbGl6ZSIsImFwcGx5IiwiYXJndW1lbnRzIiwiX2dldFNtYXJ0U2NoZWR1bGUiLCJub3RpZmljYXRpb24iLCJjb250ZXh0Iiwibm93IiwiRGF0ZSIsInByaW9yaXR5IiwiTm90aWZpY2F0aW9uUHJpb3JpdHkiLCJVUkdFTlQiLCJzY2hlZHVsZWRUaW1lIiwicmVhc29uIiwic2hvdWxkU2VuZCIsImlzSW5Eb05vdERpc3R1cmIiLCJwcmVmZXJlbmNlcyIsImRvTm90RGlzdHVyYiIsIkhJR0giLCJlbmRUaW1lIiwiZ2V0RG9Ob3REaXN0dXJiRW5kVGltZSIsInVzZXJBY3Rpdml0eSIsImlzRm9jdXNlZCIsInNtYXJ0U2NoZWR1bGluZyIsInNraXBEdXJpbmdGb2N1cyIsImVuZEZvY3VzVGltZSIsImxhc3RBY3Rpdml0eSIsImdldFRpbWUiLCJpc0luTWVldGluZyIsInNraXBEdXJpbmdNZWV0aW5ncyIsImFmdGVyTWVldGluZ1RpbWUiLCJyZWNlbnROb3RpZmljYXRpb25zIiwibm90aWZpY2F0aW9uSGlzdG9yeSIsImZpbHRlciIsInRpbWVzdGFtcCIsImNhdGVnb3J5UHJlZnMiLCJjYXRlZ29yaWVzIiwiY2F0ZWdvcnkiLCJmcmVxdWVuY3kiLCJtYXhQZXJEYXkiLCJ0b2RheU5vdGlmaWNhdGlvbnMiLCJ0b0RhdGVTdHJpbmciLCJsZW5ndGgiLCJzY2hlZHVsZWRGb3IiLCJnZXRTbWFydFNjaGVkdWxlIiwiX3giLCJfeDIiLCJfc2NoZWR1bGVUaW1lck5vdGlmaWNhdGlvbnMiLCJ0aW1lcklkIiwiZHVyYXRpb24iLCJjb21wbGV0aW9uVGltZSIsImNvbXBsZXRpb25Ob3RpZmljYXRpb24iLCJpZCIsInR5cGUiLCJ0aXRsZSIsIm1lc3NhZ2UiLCJ1c2VySWQiLCJzZXNzaW9uSWQiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJzY2hlZHVsZU5vdGlmaWNhdGlvbiIsInNjaGVkdWxlVGltZXJOb3RpZmljYXRpb25zIiwiX3gzIiwiX3g0IiwiX3NjaGVkdWxlTWlsZXN0b25lTm90aWZpY2F0aW9uIiwibWlsZXN0b25lSWQiLCJtaWxlc3RvbmVUeXBlIiwibWlsZXN0b25lTm90aWZpY2F0aW9uIiwiZGF0YSIsInNlbmRJbW1lZGlhdGVOb3RpZmljYXRpb24iLCJzY2hlZHVsZU1pbGVzdG9uZU5vdGlmaWNhdGlvbiIsIl94NSIsIl94NiIsIl9zY2hlZHVsZUJyZWFrUmVtaW5kZXIiLCJicmVha0R1cmF0aW9uIiwiYnJlYWtUaW1lIiwiYnJlYWtOb3RpZmljYXRpb24iLCJOT1JNQUwiLCJzY2hlZHVsZUJyZWFrUmVtaW5kZXIiLCJfeDciLCJfeDgiLCJfeDkiLCJfY2FuY2VsU2NoZWR1bGVkTm90aWZpY2F0aW9uIiwibm90aWZpY2F0aW9uSWQiLCJ0aW1lb3V0IiwiZ2V0IiwiY2xlYXJUaW1lb3V0IiwiZGVsZXRlIiwiY2FuY2VsU2NoZWR1bGVkTm90aWZpY2F0aW9uIiwiX3gwIiwiX2dldFNjaGVkdWxlZE5vdGlmaWNhdGlvbnMiLCJBcnJheSIsImZyb20iLCJrZXlzIiwiZ2V0U2NoZWR1bGVkTm90aWZpY2F0aW9ucyIsIl9kaXNwb3NlIiwiZm9yRWFjaCIsImNsZWFyIiwiZGlzcG9zZSIsImRuZCIsImN1cnJlbnRUaW1lIiwiZW5hYmxlZCIsImN1cnJlbnRNaW51dGVzIiwiZ2V0SG91cnMiLCJnZXRNaW51dGVzIiwiX2RuZCRzdGFydFRpbWUkc3BsaXQkIiwic3RhcnRUaW1lIiwic3BsaXQiLCJtYXAiLCJOdW1iZXIiLCJfZG5kJHN0YXJ0VGltZSRzcGxpdCQyIiwiX3NsaWNlZFRvQXJyYXkyIiwic3RhcnRIb3VyIiwic3RhcnRNaW51dGUiLCJfZG5kJGVuZFRpbWUkc3BsaXQkbWEiLCJfZG5kJGVuZFRpbWUkc3BsaXQkbWEyIiwiZW5kSG91ciIsImVuZE1pbnV0ZSIsInN0YXJ0TWludXRlcyIsImVuZE1pbnV0ZXMiLCJfZG5kJGVuZFRpbWUkc3BsaXQkbWEzIiwiX2RuZCRlbmRUaW1lJHNwbGl0JG1hNCIsInNldEhvdXJzIiwic2V0RGF0ZSIsImdldERhdGUiXSwic291cmNlcyI6WyJOb3RpZmljYXRpb25TY2hlZHVsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBOb3RpZmljYXRpb24gU2NoZWR1bGVyIGZvciBPZmZTY3JlZW4gQnVkZHlcbiAqIEhhbmRsZXMgaW50ZWxsaWdlbnQgbm90aWZpY2F0aW9uIHRpbWluZyBhbmQgc21hcnQgc2NoZWR1bGluZ1xuICovXG5cbmltcG9ydCB7IE5vdGlmaWNhdGlvbkRhdGEsIFNtYXJ0U2NoZWR1bGVDb250ZXh0LCBTY2hlZHVsZVJlc3VsdCwgTm90aWZpY2F0aW9uUHJpb3JpdHkgfSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IE5vdGlmaWNhdGlvblNlcnZpY2UgfSBmcm9tICcuL05vdGlmaWNhdGlvblNlcnZpY2UnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vLi4vdXRpbHMvTG9nZ2VyJztcblxuZXhwb3J0IGNsYXNzIE5vdGlmaWNhdGlvblNjaGVkdWxlciB7XG4gICAgcHJpdmF0ZSBub3RpZmljYXRpb25TZXJ2aWNlOiBOb3RpZmljYXRpb25TZXJ2aWNlO1xuICAgIHByaXZhdGUgc2NoZWR1bGVkTm90aWZpY2F0aW9ucyA9IG5ldyBNYXA8c3RyaW5nLCBOb2RlSlMuVGltZW91dD4oKTtcbiAgICBwcml2YXRlIGlzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKG5vdGlmaWNhdGlvblNlcnZpY2U6IE5vdGlmaWNhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy5ub3RpZmljYXRpb25TZXJ2aWNlID0gbm90aWZpY2F0aW9uU2VydmljZTtcbiAgICB9XG5cbiAgICBhc3luYyBpbml0aWFsaXplKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdGhpcy5pc0luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdOb3RpZmljYXRpb25TY2hlZHVsZXIgaW5pdGlhbGl6ZWQnKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgTm90aWZpY2F0aW9uU2NoZWR1bGVyOicsIGVycm9yKTtcbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgZ2V0U21hcnRTY2hlZHVsZShcbiAgICAgICAgbm90aWZpY2F0aW9uOiBOb3RpZmljYXRpb25EYXRhLFxuICAgICAgICBjb250ZXh0OiBTbWFydFNjaGVkdWxlQ29udGV4dFxuICAgICk6IFByb21pc2U8U2NoZWR1bGVSZXN1bHQ+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICAgICAgICAgIC8vIENoZWNrIGlmIG5vdGlmaWNhdGlvbiBpcyB1cmdlbnQgLSBzZW5kIGltbWVkaWF0ZWx5XG4gICAgICAgICAgICBpZiAobm90aWZpY2F0aW9uLnByaW9yaXR5ID09PSBOb3RpZmljYXRpb25Qcmlvcml0eS5VUkdFTlQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZWRUaW1lOiBub3csXG4gICAgICAgICAgICAgICAgICAgIHByaW9yaXR5OiBub3RpZmljYXRpb24ucHJpb3JpdHksXG4gICAgICAgICAgICAgICAgICAgIHJlYXNvbjogJ1VyZ2VudCBub3RpZmljYXRpb24gLSBpbW1lZGlhdGUgZGVsaXZlcnknLFxuICAgICAgICAgICAgICAgICAgICBzaG91bGRTZW5kOiB0cnVlLFxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIENoZWNrIGRvIG5vdCBkaXN0dXJiIGhvdXJzXG4gICAgICAgICAgICBpZiAodGhpcy5pc0luRG9Ob3REaXN0dXJiKGNvbnRleHQucHJlZmVyZW5jZXMuZG9Ob3REaXN0dXJiLCBub3cpKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vdGlmaWNhdGlvbi5wcmlvcml0eSA9PT0gTm90aWZpY2F0aW9uUHJpb3JpdHkuSElHSCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBTZW5kIGF0IGVuZCBvZiBkbyBub3QgZGlzdHVyYiBwZXJpb2RcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZW5kVGltZSA9IHRoaXMuZ2V0RG9Ob3REaXN0dXJiRW5kVGltZShjb250ZXh0LnByZWZlcmVuY2VzLmRvTm90RGlzdHVyYiwgbm93KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlZFRpbWU6IGVuZFRpbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eTogbm90aWZpY2F0aW9uLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29uOiAnU2NoZWR1bGVkIGZvciBhZnRlciBkby1ub3QtZGlzdHVyYiBob3VycycsXG4gICAgICAgICAgICAgICAgICAgICAgICBzaG91bGRTZW5kOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZWRUaW1lOiBub3csXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eTogbm90aWZpY2F0aW9uLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29uOiAnU2tpcHBlZCBkdWUgdG8gZG8tbm90LWRpc3R1cmInLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkU2VuZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDaGVjayB1c2VyJ3MgZm9jdXMgc3RhdGVcbiAgICAgICAgICAgIGlmIChjb250ZXh0LnVzZXJBY3Rpdml0eS5pc0ZvY3VzZWQgJiYgY29udGV4dC5wcmVmZXJlbmNlcy5zbWFydFNjaGVkdWxpbmcuc2tpcER1cmluZ0ZvY3VzKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vdGlmaWNhdGlvbi5wcmlvcml0eSA9PT0gTm90aWZpY2F0aW9uUHJpb3JpdHkuSElHSCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbmRGb2N1c1RpbWUgPSBuZXcgRGF0ZShjb250ZXh0LnVzZXJBY3Rpdml0eS5sYXN0QWN0aXZpdHkuZ2V0VGltZSgpICsgNjAwMDApOyAvLyAxIG1pbnV0ZSBhZnRlciBsYXN0IGFjdGl2aXR5XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZWRUaW1lOiBlbmRGb2N1c1RpbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eTogbm90aWZpY2F0aW9uLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29uOiAnU2NoZWR1bGVkIGZvciBhZnRlciBmb2N1cyBwZXJpb2QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkU2VuZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVkVGltZTogbm93LFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHk6IG5vdGlmaWNhdGlvbi5wcmlvcml0eSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlYXNvbjogJ1NraXBwZWQgZHVyaW5nIGZvY3VzIHNlc3Npb24nLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkU2VuZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBDaGVjayBtZWV0aW5nIHN0YXR1c1xuICAgICAgICAgICAgaWYgKGNvbnRleHQudXNlckFjdGl2aXR5LmlzSW5NZWV0aW5nICYmIGNvbnRleHQucHJlZmVyZW5jZXMuc21hcnRTY2hlZHVsaW5nLnNraXBEdXJpbmdNZWV0aW5ncykge1xuICAgICAgICAgICAgICAgIGlmIChub3RpZmljYXRpb24ucHJpb3JpdHkgPT09IE5vdGlmaWNhdGlvblByaW9yaXR5LkhJR0gpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWZ0ZXJNZWV0aW5nVGltZSA9IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgKyAzMDAwMDApOyAvLyA1IG1pbnV0ZXMgZnJvbSBub3dcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlZFRpbWU6IGFmdGVyTWVldGluZ1RpbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBwcmlvcml0eTogbm90aWZpY2F0aW9uLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgICAgICAgICAgcmVhc29uOiAnU2NoZWR1bGVkIGZvciBhZnRlciBtZWV0aW5nJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3VsZFNlbmQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlZFRpbWU6IG5vdyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW9yaXR5OiBub3RpZmljYXRpb24ucHJpb3JpdHksXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFzb246ICdTa2lwcGVkIGR1cmluZyBtZWV0aW5nJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3VsZFNlbmQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gQ2hlY2sgbm90aWZpY2F0aW9uIGZyZXF1ZW5jeSBsaW1pdHNcbiAgICAgICAgICAgIGNvbnN0IHJlY2VudE5vdGlmaWNhdGlvbnMgPSBjb250ZXh0Lm5vdGlmaWNhdGlvbkhpc3RvcnkuZmlsdGVyKFxuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbiA9PlxuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb24udGltZXN0YW1wLmdldFRpbWUoKSA+IG5vdy5nZXRUaW1lKCkgLSAzMDAwMDAgLy8gTGFzdCA1IG1pbnV0ZXNcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGNvbnN0IGNhdGVnb3J5UHJlZnMgPSBjb250ZXh0LnByZWZlcmVuY2VzLmNhdGVnb3JpZXNbbm90aWZpY2F0aW9uLmNhdGVnb3J5XTtcbiAgICAgICAgICAgIGlmIChjYXRlZ29yeVByZWZzPy5mcmVxdWVuY3kubWF4UGVyRGF5KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdG9kYXlOb3RpZmljYXRpb25zID0gY29udGV4dC5ub3RpZmljYXRpb25IaXN0b3J5LmZpbHRlcihcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uID0+IG5vdGlmaWNhdGlvbi50aW1lc3RhbXAudG9EYXRlU3RyaW5nKCkgPT09IG5vdy50b0RhdGVTdHJpbmcoKVxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBpZiAodG9kYXlOb3RpZmljYXRpb25zLmxlbmd0aCA+PSBjYXRlZ29yeVByZWZzLmZyZXF1ZW5jeS5tYXhQZXJEYXkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlZFRpbWU6IG5vdyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW9yaXR5OiBub3RpZmljYXRpb24ucHJpb3JpdHksXG4gICAgICAgICAgICAgICAgICAgICAgICByZWFzb246ICdEYWlseSBsaW1pdCByZWFjaGVkIGZvciB0aGlzIGNhdGVnb3J5JyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNob3VsZFNlbmQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gRGVmYXVsdCB0byBpbW1lZGlhdGUgc2NoZWR1bGluZ1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBzY2hlZHVsZWRUaW1lOiBub3RpZmljYXRpb24uc2NoZWR1bGVkRm9yIHx8IG5vdyxcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogbm90aWZpY2F0aW9uLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgIHJlYXNvbjogJ0RlZmF1bHQgc2NoZWR1bGluZyAtIG5vIHJlc3RyaWN0aW9ucycsXG4gICAgICAgICAgICAgICAgc2hvdWxkU2VuZDogdHJ1ZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBnZXQgc21hcnQgc2NoZWR1bGU6JywgZXJyb3IpO1xuICAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gaW1tZWRpYXRlIHNjaGVkdWxpbmdcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc2NoZWR1bGVkVGltZTogbm90aWZpY2F0aW9uLnNjaGVkdWxlZEZvciB8fCBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICAgIHByaW9yaXR5OiBub3RpZmljYXRpb24ucHJpb3JpdHksXG4gICAgICAgICAgICAgICAgcmVhc29uOiAnRmFsbGJhY2sgdG8gaW1tZWRpYXRlIHNjaGVkdWxpbmcgZHVlIHRvIGVycm9yJyxcbiAgICAgICAgICAgICAgICBzaG91bGRTZW5kOiB0cnVlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHNjaGVkdWxlVGltZXJOb3RpZmljYXRpb25zKHRpbWVySWQ6IHN0cmluZywgZHVyYXRpb246IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gU2NoZWR1bGUgY29tcGxldGlvbiBub3RpZmljYXRpb25cbiAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25UaW1lID0gbmV3IERhdGUoRGF0ZS5ub3coKSArIGR1cmF0aW9uICogMTAwMCk7XG5cbiAgICAgICAgICAgIC8vIENyZWF0ZSBjb21wbGV0aW9uIG5vdGlmaWNhdGlvblxuICAgICAgICAgICAgY29uc3QgY29tcGxldGlvbk5vdGlmaWNhdGlvbjogTm90aWZpY2F0aW9uRGF0YSA9IHtcbiAgICAgICAgICAgICAgICBpZDogYHRpbWVyX2NvbXBsZXRlXyR7dGltZXJJZH1gLFxuICAgICAgICAgICAgICAgIHR5cGU6ICd0aW1lcl9jb21wbGV0ZScgYXMgYW55LFxuICAgICAgICAgICAgICAgIGNhdGVnb3J5OiAndGltZXJzJyBhcyBhbnksXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdGb2N1cyBTZXNzaW9uIENvbXBsZXRlJyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAnR3JlYXQgam9iISBZb3VyIGZvY3VzIHNlc3Npb24gaGFzIGVuZGVkLicsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IE5vdGlmaWNhdGlvblByaW9yaXR5LkhJR0gsXG4gICAgICAgICAgICAgICAgdXNlcklkOiAnY3VycmVudF91c2VyJywgLy8gV291bGQgYmUgYWN0dWFsIHVzZXIgSURcbiAgICAgICAgICAgICAgICBzZXNzaW9uSWQ6IHRpbWVySWQsXG4gICAgICAgICAgICAgICAgc2NoZWR1bGVkRm9yOiBjb21wbGV0aW9uVGltZSxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgYXdhaXQgdGhpcy5ub3RpZmljYXRpb25TZXJ2aWNlLnNjaGVkdWxlTm90aWZpY2F0aW9uKGNvbXBsZXRpb25Ob3RpZmljYXRpb24pO1xuXG4gICAgICAgICAgICBsb2dnZXIuaW5mbygnVGltZXIgbm90aWZpY2F0aW9ucyBzY2hlZHVsZWQnLCB7IHRpbWVySWQsIGR1cmF0aW9uLCBjb21wbGV0aW9uVGltZSB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHNjaGVkdWxlIHRpbWVyIG5vdGlmaWNhdGlvbnM6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgYXN5bmMgc2NoZWR1bGVNaWxlc3RvbmVOb3RpZmljYXRpb24obWlsZXN0b25lSWQ6IHN0cmluZywgbWlsZXN0b25lVHlwZTogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBtaWxlc3RvbmVOb3RpZmljYXRpb246IE5vdGlmaWNhdGlvbkRhdGEgPSB7XG4gICAgICAgICAgICAgICAgaWQ6IGBtaWxlc3RvbmVfJHttaWxlc3RvbmVJZH1gLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdtaWxlc3RvbmVfYWNoaWV2ZW1lbnQnIGFzIGFueSxcbiAgICAgICAgICAgICAgICBjYXRlZ29yeTogJ2FjaGlldmVtZW50cycgYXMgYW55LFxuICAgICAgICAgICAgICAgIHRpdGxlOiAnTWlsZXN0b25lIEFjaGlldmVkIScsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogYENvbmdyYXR1bGF0aW9ucyEgWW91J3ZlIGFjaGlldmVkIGEgbmV3ICR7bWlsZXN0b25lVHlwZX0gbWlsZXN0b25lLmAsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IE5vdGlmaWNhdGlvblByaW9yaXR5LkhJR0gsXG4gICAgICAgICAgICAgICAgdXNlcklkOiAnY3VycmVudF91c2VyJyxcbiAgICAgICAgICAgICAgICBkYXRhOiB7IG1pbGVzdG9uZUlkLCBtaWxlc3RvbmVUeXBlIH0sXG4gICAgICAgICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGF3YWl0IHRoaXMubm90aWZpY2F0aW9uU2VydmljZS5zZW5kSW1tZWRpYXRlTm90aWZpY2F0aW9uKG1pbGVzdG9uZU5vdGlmaWNhdGlvbik7XG5cbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdNaWxlc3RvbmUgbm90aWZpY2F0aW9uIHNlbnQnLCB7IG1pbGVzdG9uZUlkLCBtaWxlc3RvbmVUeXBlIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gc2NoZWR1bGUgbWlsZXN0b25lIG5vdGlmaWNhdGlvbjonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBzY2hlZHVsZUJyZWFrUmVtaW5kZXIoXG4gICAgICAgIHNlc3Npb25JZDogc3RyaW5nLFxuICAgICAgICBicmVha0R1cmF0aW9uOiBudW1iZXIsXG4gICAgICAgIGJyZWFrVGltZTogRGF0ZVxuICAgICk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgYnJlYWtOb3RpZmljYXRpb246IE5vdGlmaWNhdGlvbkRhdGEgPSB7XG4gICAgICAgICAgICAgICAgaWQ6IGBicmVha18ke3Nlc3Npb25JZH1gLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdicmVha19yZW1pbmRlcicgYXMgYW55LFxuICAgICAgICAgICAgICAgIGNhdGVnb3J5OiAncmVtaW5kZXJzJyBhcyBhbnksXG4gICAgICAgICAgICAgICAgdGl0bGU6ICdCcmVhayBUaW1lIScsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogYFRpbWUgdG8gdGFrZSBhICR7YnJlYWtEdXJhdGlvbn0tbWludXRlIGJyZWFrLiBZb3UndmUgZWFybmVkIGl0IWAsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IE5vdGlmaWNhdGlvblByaW9yaXR5Lk5PUk1BTCxcbiAgICAgICAgICAgICAgICB1c2VySWQ6ICdjdXJyZW50X3VzZXInLFxuICAgICAgICAgICAgICAgIHNlc3Npb25JZCxcbiAgICAgICAgICAgICAgICBzY2hlZHVsZWRGb3I6IGJyZWFrVGltZSxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgYXdhaXQgdGhpcy5ub3RpZmljYXRpb25TZXJ2aWNlLnNjaGVkdWxlTm90aWZpY2F0aW9uKGJyZWFrTm90aWZpY2F0aW9uKTtcblxuICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ0JyZWFrIHJlbWluZGVyIHNjaGVkdWxlZCcsIHsgc2Vzc2lvbklkLCBicmVha0R1cmF0aW9uLCBicmVha1RpbWUgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoJ0ZhaWxlZCB0byBzY2hlZHVsZSBicmVhayByZW1pbmRlcjonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBjYW5jZWxTY2hlZHVsZWROb3RpZmljYXRpb24obm90aWZpY2F0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdGltZW91dCA9IHRoaXMuc2NoZWR1bGVkTm90aWZpY2F0aW9ucy5nZXQobm90aWZpY2F0aW9uSWQpO1xuICAgICAgICAgICAgaWYgKHRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZWROb3RpZmljYXRpb25zLmRlbGV0ZShub3RpZmljYXRpb25JZCk7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ1NjaGVkdWxlZCBub3RpZmljYXRpb24gY2FuY2VsbGVkJywgeyBub3RpZmljYXRpb25JZCB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIGNhbmNlbCBzY2hlZHVsZWQgbm90aWZpY2F0aW9uOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGdldFNjaGVkdWxlZE5vdGlmaWNhdGlvbnMoKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnNjaGVkdWxlZE5vdGlmaWNhdGlvbnMua2V5cygpKTtcbiAgICB9XG5cbiAgICBhc3luYyBkaXNwb3NlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gQ2xlYXIgYWxsIHRpbWVvdXRzXG4gICAgICAgICAgICB0aGlzLnNjaGVkdWxlZE5vdGlmaWNhdGlvbnMuZm9yRWFjaCgodGltZW91dCkgPT4ge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZWROb3RpZmljYXRpb25zLmNsZWFyKCk7XG4gICAgICAgICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdOb3RpZmljYXRpb25TY2hlZHVsZXIgZGlzcG9zZWQnKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZGlzcG9zaW5nIE5vdGlmaWNhdGlvblNjaGVkdWxlcjonLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGlzSW5Eb05vdERpc3R1cmIoZG5kOiBhbnksIGN1cnJlbnRUaW1lOiBEYXRlKTogYm9vbGVhbiB7XG4gICAgICAgIGlmICghZG5kLmVuYWJsZWQpIHJldHVybiBmYWxzZTtcblxuICAgICAgICBjb25zdCBub3cgPSBjdXJyZW50VGltZTtcbiAgICAgICAgY29uc3QgY3VycmVudE1pbnV0ZXMgPSBub3cuZ2V0SG91cnMoKSAqIDYwICsgbm93LmdldE1pbnV0ZXMoKTtcblxuICAgICAgICBjb25zdCBbc3RhcnRIb3VyLCBzdGFydE1pbnV0ZV0gPSBkbmQuc3RhcnRUaW1lLnNwbGl0KCc6JykubWFwKE51bWJlcik7XG4gICAgICAgIGNvbnN0IFtlbmRIb3VyLCBlbmRNaW51dGVdID0gZG5kLmVuZFRpbWUuc3BsaXQoJzonKS5tYXAoTnVtYmVyKTtcblxuICAgICAgICBjb25zdCBzdGFydE1pbnV0ZXMgPSBzdGFydEhvdXIgKiA2MCArIHN0YXJ0TWludXRlO1xuICAgICAgICBjb25zdCBlbmRNaW51dGVzID0gZW5kSG91ciAqIDYwICsgZW5kTWludXRlO1xuXG4gICAgICAgIC8vIEhhbmRsZSBvdmVybmlnaHQgRE5EIChlLmcuLCAyMjowMCB0byAwNzowMClcbiAgICAgICAgaWYgKHN0YXJ0TWludXRlcyA+IGVuZE1pbnV0ZXMpIHtcbiAgICAgICAgICAgIHJldHVybiBjdXJyZW50TWludXRlcyA+PSBzdGFydE1pbnV0ZXMgfHwgY3VycmVudE1pbnV0ZXMgPD0gZW5kTWludXRlcztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBjdXJyZW50TWludXRlcyA+PSBzdGFydE1pbnV0ZXMgJiYgY3VycmVudE1pbnV0ZXMgPD0gZW5kTWludXRlcztcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldERvTm90RGlzdHVyYkVuZFRpbWUoZG5kOiBhbnksIGN1cnJlbnRUaW1lOiBEYXRlKTogRGF0ZSB7XG4gICAgICAgIGNvbnN0IFtlbmRIb3VyLCBlbmRNaW51dGVdID0gZG5kLmVuZFRpbWUuc3BsaXQoJzonKS5tYXAoTnVtYmVyKTtcbiAgICAgICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKGN1cnJlbnRUaW1lKTtcbiAgICAgICAgZW5kVGltZS5zZXRIb3VycyhlbmRIb3VyLCBlbmRNaW51dGUsIDAsIDApO1xuXG4gICAgICAgIC8vIElmIGVuZCB0aW1lIGlzIGVhcmxpZXIgdGhhbiBjdXJyZW50IHRpbWUsIHNjaGVkdWxlIGZvciBuZXh0IGRheVxuICAgICAgICBpZiAoZW5kVGltZSA8PSBjdXJyZW50VGltZSkge1xuICAgICAgICAgICAgZW5kVGltZS5zZXREYXRlKGVuZFRpbWUuZ2V0RGF0ZSgpICsgMSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gZW5kVGltZTtcbiAgICB9XG59Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFLQSxJQUFBQSxNQUFBLEdBQUFDLE9BQUE7QUFFQSxJQUFBQyxPQUFBLEdBQUFELE9BQUE7QUFBNEMsSUFFL0JFLHFCQUFxQixHQUFBQyxPQUFBLENBQUFELHFCQUFBO0VBSzlCLFNBQUFBLHNCQUFZRSxtQkFBd0MsRUFBRTtJQUFBLElBQUFDLGdCQUFBLENBQUFDLE9BQUEsUUFBQUoscUJBQUE7SUFBQSxLQUg5Q0ssc0JBQXNCLEdBQUcsSUFBSUMsR0FBRyxDQUF5QixDQUFDO0lBQUEsS0FDMURDLGFBQWEsR0FBRyxLQUFLO0lBR3pCLElBQUksQ0FBQ0wsbUJBQW1CLEdBQUdBLG1CQUFtQjtFQUNsRDtFQUFDLFdBQUFNLGFBQUEsQ0FBQUosT0FBQSxFQUFBSixxQkFBQTtJQUFBUyxHQUFBO0lBQUFDLEtBQUE7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