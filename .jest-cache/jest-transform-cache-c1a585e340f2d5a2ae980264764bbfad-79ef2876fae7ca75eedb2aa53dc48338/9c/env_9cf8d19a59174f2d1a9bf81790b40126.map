{"version":3,"names":["EnvironmentDetector","_classCallCheck2","default","environment","isValidated","detectEnvironment","info","createEnvironmentInfo","validate","_createClass2","key","value","envFromProcess","process","env","APP_ENV","normalizedEnv","toUpperCase","trim","console","log","warn","nodeEnv","NODE_ENV","source","isDevelopment","isProduction","isTest","detectedAt","Date","validateEnvironmentSpecificRules","error","validateLocalEnvironment","validateProductionEnvironment","dangerousPatterns","pattern","name","allEnvValues","Object","assign","envString","JSON","stringify","_ref","test","Error","requiredVariables","missingVariables","filter","length","join","supabaseUrl","SUPABASE_URL","includes","getEnvironment","getEnvironmentInfo","isLocal","isProd","setEnvironment","resetToAuto","getInstance","instance","environmentDetector","exports"],"sources":["env.ts"],"sourcesContent":["/**\n * Environment Detection and Validation System\n * Provides automatic environment detection and validation for the single APP_ENV variable\n */\n\nimport { Environment, EnvironmentInfo } from './types';\n\nclass EnvironmentDetector {\n  private static instance: EnvironmentDetector | null = null;\n  private environment: Environment = 'LOCAL';\n  private isValidated: boolean = false;\n  private info: EnvironmentInfo;\n\n  private constructor() {\n    this.environment = this.detectEnvironment();\n    this.info = this.createEnvironmentInfo();\n    this.validate();\n  }\n\n  static getInstance(): EnvironmentDetector {\n    if (!EnvironmentDetector.instance) {\n      EnvironmentDetector.instance = new EnvironmentDetector();\n    }\n    return EnvironmentDetector.instance;\n  }\n\n  private detectEnvironment(): Environment {\n    // Try to get APP_ENV from environment variables\n    const envFromProcess = process.env.APP_ENV;\n    \n    if (envFromProcess) {\n      const normalizedEnv = envFromProcess.toUpperCase().trim();\n      \n      if (normalizedEnv === 'LOCAL' || normalizedEnv === 'PROD') {\n        console.log(`âœ“ Environment detected from process.env: ${normalizedEnv}`);\n        return normalizedEnv as Environment;\n      } else {\n        console.warn(`âš ï¸  Invalid APP_ENV value: ${envFromProcess}. Valid values are 'LOCAL' or 'PROD'. Defaulting to LOCAL.`);\n        return 'LOCAL';\n      }\n    }\n\n    // Try to detect from NODE_ENV (development/production)\n    const nodeEnv = process.env.NODE_ENV;\n    if (nodeEnv) {\n      if (nodeEnv === 'production') {\n        console.log('âœ“ Environment detected from NODE_ENV: PROD');\n        return 'PROD';\n      } else if (nodeEnv === 'development') {\n        console.log('âœ“ Environment detected from NODE_ENV: LOCAL');\n        return 'LOCAL';\n      }\n    }\n\n    // Default to LOCAL for safety\n    console.log('â„¹ï¸  No environment specified, defaulting to LOCAL');\n    return 'LOCAL';\n  }\n\n  private createEnvironmentInfo(): EnvironmentInfo {\n    const envFromProcess = process.env.APP_ENV;\n    \n    let source: EnvironmentInfo['source'] = 'default';\n    if (envFromProcess) {\n      source = 'process.env';\n    }\n\n    return {\n      environment: this.environment,\n      isDevelopment: this.environment === 'LOCAL',\n      isProduction: this.environment === 'PROD',\n      isTest: process.env.NODE_ENV === 'test',\n      detectedAt: new Date(),\n      source,\n    };\n  }\n\n  private validate(): void {\n    if (this.isValidated) return;\n\n    try {\n      this.validateEnvironmentSpecificRules();\n      this.isValidated = true;\n      console.log(`âœ“ Environment validation passed for: ${this.environment}`);\n    } catch (error) {\n      console.error(`âŒ Environment validation failed: ${error}`);\n      throw error;\n    }\n  }\n\n  private validateEnvironmentSpecificRules(): void {\n    if (this.environment === 'LOCAL') {\n      this.validateLocalEnvironment();\n    } else {\n      this.validateProductionEnvironment();\n    }\n  }\n\n  private validateLocalEnvironment(): void {\n    console.log('ðŸ”§ Validating LOCAL environment...');\n\n    // Check for dangerous production values in LOCAL\n    const dangerousPatterns = [\n      { pattern: /secure\\.payu\\.in/i, name: 'PayU production URL' },\n      { pattern: /prod[\\w-]*\\.supabase\\.co/i, name: 'Production Supabase URL' },\n    ];\n\n    const allEnvValues = { ...process.env };\n    const envString = JSON.stringify(allEnvValues);\n\n    for (const { pattern, name } of dangerousPatterns) {\n      if (pattern.test(envString)) {\n        throw new Error(\n          `ðŸš¨ SECURITY: ${name} detected in LOCAL environment. This is not allowed.`\n        );\n      }\n    }\n\n    console.log('âœ“ LOCAL environment validation passed');\n  }\n\n  private validateProductionEnvironment(): void {\n    console.log('ðŸš€ Validating PROD environment...');\n\n    // Production-specific validations\n    const requiredVariables = [\n      'SUPABASE_URL',\n      'SUPABASE_ANON_KEY',\n    ];\n\n    const missingVariables = requiredVariables.filter(\n      (key) => !process.env[key]\n    );\n\n    if (missingVariables.length > 0) {\n      throw new Error(\n        `ðŸš¨ PROD environment missing required variables: ${missingVariables.join(', ')}`\n      );\n    }\n\n    // Check for proper Supabase URL format\n    const supabaseUrl = process.env.SUPABASE_URL;\n    if (!supabaseUrl || !supabaseUrl.includes('.supabase.co')) {\n      throw new Error('ðŸš¨ Invalid Supabase URL format in production');\n    }\n\n    console.log('âœ“ PROD environment validation passed');\n  }\n\n  getEnvironment(): Environment {\n    return this.environment;\n  }\n\n  getEnvironmentInfo(): EnvironmentInfo {\n    return { ...this.info };\n  }\n\n  isLocal(): boolean {\n    return this.environment === 'LOCAL';\n  }\n\n  isProd(): boolean {\n    return this.environment === 'PROD';\n  }\n\n  isDevelopment(): boolean {\n    return this.isLocal();\n  }\n\n  // Force environment (useful for testing)\n  setEnvironment(environment: Environment): void {\n    if (environment !== 'LOCAL' && environment !== 'PROD') {\n      throw new Error(`Invalid environment: ${environment}`);\n    }\n\n    this.environment = environment;\n    this.info = this.createEnvironmentInfo();\n    this.isValidated = false; // Revalidate with new environment\n    this.validate();\n    \n    console.log(`ðŸ”„ Environment forced to: ${environment}`);\n  }\n\n  // Reset to auto-detection\n  resetToAuto(): void {\n    this.environment = this.detectEnvironment();\n    this.info = this.createEnvironmentInfo();\n    this.isValidated = false;\n    this.validate();\n    \n    console.log('ðŸ”„ Environment reset to auto-detection');\n  }\n}\n\n// Export singleton instance\nexport const environmentDetector = EnvironmentDetector.getInstance();\n\n// Export convenience functions\nexport const getEnvironment = () => environmentDetector.getEnvironment();\nexport const isLocal = () => environmentDetector.isLocal();\nexport const isProd = () => environmentDetector.isProd();\nexport const isDevelopment = () => environmentDetector.isDevelopment();\n\n// Export environment info\nexport const getEnvironmentInfo = () => environmentDetector.getEnvironmentInfo();\n\n// Re-export types for convenience\nexport type { Environment, EnvironmentInfo };"],"mappings":"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","ignoreList":[]}