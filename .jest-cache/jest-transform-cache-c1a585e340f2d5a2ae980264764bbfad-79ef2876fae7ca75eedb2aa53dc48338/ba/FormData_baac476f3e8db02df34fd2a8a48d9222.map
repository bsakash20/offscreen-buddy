{"version":3,"names":["ensureMinArgCount","name","args","expected","length","argName","TypeError","normalizeArgs","value","blobFilename","Blob","_ref","blob","String","installFormDataPatch","formData","_formData$prototype","_formData$prototype$d","_formData$prototype2","_formData$prototype2$","_formData$prototype3","_formData$prototype3$","_formData$prototype4","_formData$prototype4$","_formData$prototype5","_formData$prototype5$","_formData$prototype6","_formData$prototype6$","_formData$prototype7","_formData$prototype7$","prototype","append","_len","arguments","props","Array","_key","_parts","push","set","_len2","_key2","replaced","i","splice","delete","_len3","_key3","get","_len4","_key4","part","has","_len5","_key5","forEach","_len6","_key6","callback","thisArg","call","entries","keys","values","Symbol","iterator"],"sources":["FormData.ts"],"sourcesContent":["// React Native's FormData implementation is missing several methods that are used in React for server actions.\n// https://github.com/facebook/react-native/blob/42dcfdd2cdb59fe545523cb57db6ee32a96b9298/packages/react-native/Libraries/Network/FormData.js#L1\n// https://github.com/facebook/react/blob/985747f81033833dca22f30b0c04704dd4bd3714/packages/react-client/src/ReactFlightReplyClient.js#L212\n\ntype ReactNativeFormDataInternal = FormData & {\n  _parts: [string, string | Blob][];\n};\n\nexport type ExpoFormDataValue = string | Blob;\nexport type ExpoFormDataPart =\n  | {\n      // WinterCG FormData string\n      string: string;\n      headers: { [name: string]: string };\n    }\n  | {\n      // WinterCG FormData blob in our wrapped form\n      blob: Blob;\n      headers: { [name: string]: string };\n      name?: string | undefined;\n      type?: string | undefined;\n    }\n  | {\n      // React Native proprietary local file\n      uri: string;\n      headers: { [name: string]: string };\n      name?: string | undefined;\n      type?: string | undefined;\n    };\n\nexport declare class ExpoFormData {\n  constructor();\n\n  // React Native proprietary local file\n  append(name: string, value: { uri: string; name?: string; type?: string }): void;\n  append(name: string, value: string): void;\n  append(name: string, value: Blob, filename?: string): void;\n\n  delete(name: string): void;\n  get(name: string): FormDataEntryValue | null;\n  getAll(name: string): FormDataEntryValue[];\n  has(name: string): boolean;\n\n  // React Native proprietary local file\n  set(name: string, value: { uri: string; name?: string; type?: string }): void;\n  set(name: string, value: string): void;\n  set(name: string, value: Blob, filename?: string): void;\n\n  // iterable\n  forEach(\n    callback: (value: FormDataEntryValue, key: string, iterable: FormData) => void,\n    thisArg?: unknown\n  ): void;\n  keys(): IterableIterator<string>;\n  values(): IterableIterator<FormDataEntryValue>;\n  entries(): IterableIterator<[string, FormDataEntryValue]>;\n  [Symbol.iterator](): IterableIterator<[string, FormDataEntryValue]>;\n}\n\nfunction ensureMinArgCount(name: string, args: any[], expected: number) {\n  if (args.length < expected) {\n    const argName = expected === 2 ? 'arguments' : 'argument';\n    // Matches the errors in Chrome.\n    throw new TypeError(\n      `Failed to execute '${name}' on 'FormData': ${expected} ${argName} required, but only ${args.length} present.`\n    );\n  }\n}\n\nfunction normalizeArgs(\n  name: string,\n  value: any,\n  blobFilename: string | undefined\n): [string, File | string] {\n  if (value instanceof Blob) {\n    // @ts-expect-error: `Blob.data.blobId` is react-native's proprietary property.\n    value.name = blobFilename ?? blob.name ?? 'blob';\n  } else if (typeof value !== 'object') {\n    value = String(value);\n  }\n  return [String(name), value];\n}\n\nexport function installFormDataPatch(formData: typeof FormData): typeof ExpoFormData {\n  formData.prototype.append = function append(this: ReactNativeFormDataInternal, ...props: any[]) {\n    ensureMinArgCount('append', props, 2);\n    // @ts-ignore: When inferred FormData.append from React Native types, it does not support the 3rd blobFilename argument.\n    const [name, value, blobFilename] = props;\n    this._parts.push(normalizeArgs(name, value, blobFilename));\n  };\n\n  // @ts-ignore: DOM.iterable is disabled for jest compat\n  formData.prototype.set = function set(this: ReactNativeFormDataInternal, ...props: any[]) {\n    ensureMinArgCount('set', props, 2);\n    const [name, value, blobFilename] = props;\n    const args = normalizeArgs(name, value, blobFilename);\n    let replaced = false;\n\n    for (let i = 0; i < this._parts.length; i++) {\n      if (this._parts[i][0] === args[0]) {\n        if (!replaced) {\n          this._parts[i] = args;\n          replaced = true;\n        } else {\n          this._parts.splice(i, 1);\n          i--;\n        }\n      }\n    }\n\n    if (!replaced) {\n      this._parts.push(args);\n    }\n  };\n\n  // @ts-ignore: DOM.iterable is disabled for jest compat\n  formData.prototype.delete ??= function (this: ReactNativeFormDataInternal, ...props: any[]) {\n    ensureMinArgCount('delete', props, 1);\n    let [name] = props;\n    name = String(name);\n    for (let i = 0; i < this._parts.length; i++) {\n      if (this._parts[i][0] === name) {\n        this._parts.splice(i, 1);\n        i--;\n      }\n    }\n  };\n\n  // @ts-ignore: DOM.iterable is disabled for jest compat\n  formData.prototype.get ??= function (\n    this: ReactNativeFormDataInternal,\n    ...props: any[]\n  ): FormDataEntryValue | null {\n    ensureMinArgCount('get', props, 1);\n    let [name] = props;\n    name = String(name);\n    for (const part of this._parts) {\n      if (part[0] === name) {\n        // @ts-expect-error: We don't perform correct normalization when setting the args so the return value will\n        // not be a normalized File object.\n        return part[1];\n      }\n    }\n    return null;\n  };\n\n  // @ts-ignore: DOM.iterable is disabled for jest compat\n  formData.prototype.has ??= function (this: ReactNativeFormDataInternal, ...props: any[]) {\n    ensureMinArgCount('has', props, 1);\n    let [name] = props;\n    name = String(name);\n    for (const part of this._parts) {\n      if (part[0] === name) {\n        return true;\n      }\n    }\n    return false;\n  };\n\n  // Required for RSC: https://github.com/facebook/react/blob/985747f81033833dca22f30b0c04704dd4bd3714/packages/react-dom-bindings/src/server/ReactFizzConfigDOM.js#L1056\n  // @ts-ignore: DOM.iterable is disabled for jest compat\n  formData.prototype.forEach ??= function forEach(\n    this: ReactNativeFormDataInternal,\n    ...props: any[]\n  ) {\n    ensureMinArgCount('forEach', props, 1);\n\n    const [callback, thisArg] = props;\n    if (typeof callback !== 'function') {\n      throw new TypeError(\n        `Failed to execute 'forEach' on 'FormData': parameter 1 is not of type 'Function'.`\n      );\n    }\n    for (const part of this._parts) {\n      // @ts-ignore: part[1] could throw an error in Node.js runtime because of `File` type mismatch.\n      callback.call(thisArg, part[1], part[0], this);\n    }\n  };\n\n  // Required for RSC: https://github.com/facebook/react/blob/985747f81033833dca22f30b0c04704dd4bd3714/packages/react-server/src/ReactFlightServer.js#L2117\n  // @ts-ignore: DOM.iterable is disabled for jest compat\n  formData.prototype.entries ??= function* entries(\n    this: ReactNativeFormDataInternal\n  ): IterableIterator<[string, FormDataEntryValue]> {\n    for (const part of this._parts) {\n      // @ts-expect-error: We don't perform correct normalization when setting the args so the return value will\n      // not be a normalized File object.\n      yield part;\n    }\n  };\n\n  // @ts-ignore: DOM.iterable is disabled for jest compat\n  formData.prototype.keys ??= function* keys(this: ReactNativeFormDataInternal) {\n    for (const part of this._parts) {\n      yield part[0];\n    }\n  };\n\n  // @ts-ignore: DOM.iterable is disabled for jest compat\n  formData.prototype.values ??= function* values(\n    this: ReactNativeFormDataInternal\n  ): IterableIterator<FormDataEntryValue> {\n    for (const part of this._parts) {\n      // @ts-expect-error: We don't perform correct normalization when setting the args so the return value will\n      // not be a normalized File object.\n      yield part[1];\n    }\n  };\n\n  // @ts-ignore: DOM.iterable is disabled for jest compat\n  formData.prototype[Symbol.iterator] = formData.prototype.entries;\n\n  return formData as unknown as typeof ExpoFormData;\n}\n"],"mappings":"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","ignoreList":[]}