3a2fe812016c71aa3511d7305243dbca
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault").default;
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _TestHelpers = require("./TestHelpers");
var _TestConstants = require("./TestConstants");
describe('SecurityTestSuite', function () {
  var mockFakeCallService;
  var mockVoiceSynthesisService;
  var mockCallerIDService;
  beforeAll(function () {
    _TestHelpers.TestSetupHelper.setupTestEnvironment();
    mockFakeCallService = _TestHelpers.TestSetupHelper.createMockFakeCallService();
    mockVoiceSynthesisService = _TestHelpers.TestSetupHelper.createMockVoiceSynthesisService();
    mockCallerIDService = _TestHelpers.TestSetupHelper.createMockCallerIDService();
  });
  afterAll(function () {
    _TestHelpers.TestSetupHelper.cleanupTestEnvironment();
  });
  beforeEach(function () {
    jest.clearAllMocks();
  });
  describe('Input Validation and Sanitization Tests', function () {
    test('should detect XSS attacks in caller names', (0, _asyncToGenerator2.default)(function* () {
      var xssInputs = ['<script>alert("xss")</script>', 'javascript:alert("xss")', '<img src=x onerror=alert("xss")>', '"><script>alert("xss")</script>'];
      xssInputs.forEach(function (input) {
        var isValid = _TestHelpers.SecurityTestHelper.validateInputSanitization(input, false);
        expect(isValid).toBe(true);
      });
    }));
    test('should validate caller name length limits', (0, _asyncToGenerator2.default)(function* () {
      var callerNameRules = _TestConstants.SECURITY_RULES.INPUT_VALIDATION;
      var validNames = ['John Smith', 'Dr. Sarah Johnson', 'A'.repeat(callerNameRules.MAX_CALLER_NAME_LENGTH)];
      validNames.forEach(function (name) {
        expect(name.length).toBeLessThanOrEqual(callerNameRules.MAX_CALLER_NAME_LENGTH);
      });
    }));
    test('should enforce character restrictions', (0, _asyncToGenerator2.default)(function* () {
      var allowedPattern = _TestConstants.SECURITY_RULES.INPUT_VALIDATION.ALLOWED_CHARACTERS;
      var validInputs = ['John Smith', 'Dr. Johnson (Acme Corp)', 'Mary-Jane O\'Brien', 'Business_name_123'];
      var invalidInputs = ['John <script>alert("xss")</script> Smith', 'Test@#$%^&*()', 'John| Smith'];
      validInputs.forEach(function (input) {
        expect(allowedPattern.test(input)).toBe(true);
      });
      invalidInputs.forEach(function (input) {
        expect(allowedPattern.test(input)).toBe(false);
      });
    }));
  });
  describe('Pro Tier Security Tests', function () {
    test('should validate pro tier access controls', (0, _asyncToGenerator2.default)(function* () {
      var proTierValidation = function () {
        var _ref5 = (0, _asyncToGenerator2.default)(function* (userId, requiredFeature) {
          var mockProTierService = {
            validateProTierAccess: jest.fn().mockImplementation(function (uid) {
              if (uid === 'pro_user_123') {
                return Promise.resolve(true);
              }
              return Promise.resolve(false);
            })
          };
          var hasAccess = yield mockProTierService.validateProTierAccess(userId);
          return {
            hasAccess: hasAccess,
            canAccessFeature: hasAccess
          };
        });
        return function proTierValidation(_x, _x2) {
          return _ref5.apply(this, arguments);
        };
      }();
      var proUserResult = yield proTierValidation('pro_user_123', 'fake_calls');
      expect(proUserResult.canAccessFeature).toBe(true);
      var freeUserResult = yield proTierValidation('free_user_456', 'fake_calls');
      expect(freeUserResult.canAccessFeature).toBe(false);
    }));
    test('should prevent pro tier bypass attempts', (0, _asyncToGenerator2.default)(function* () {
      var bypassAttempts = [{
        method: 'header_manipulation',
        data: {
          'X-User-Tier': 'pro'
        }
      }, {
        method: 'cookie_manipulation',
        data: {
          'user_tier': 'pro'
        }
      }, {
        method: 'local_storage_override',
        data: {
          subscription_tier: 'pro'
        }
      }];
      bypassAttempts.forEach(function (attempt) {
        var isValidRequest = function isValidRequest(data) {
          if (data['X-User-Tier'] === 'pro') return false;
          if (data.user_tier === 'pro') return false;
          return true;
        };
        var isValid = isValidRequest(attempt.data);
        expect(isValid).toBe(false);
      });
    }));
  });
  describe('Caller ID Safety Validation Tests', function () {
    test('should validate emergency number protection', (0, _asyncToGenerator2.default)(function* () {
      var emergencyNumbers = ['911', '112', '999', '000'];
      emergencyNumbers.forEach(function (number) {
        var validation = mockCallerIDService.validatePhoneNumber(number);
        expect(validation.isEmergency).toBe(true);
      });
    }));
    test('should generate safe caller IDs', (0, _asyncToGenerator2.default)(function* () {
      var safeCallerID = yield mockCallerIDService.generateSafeCallerID({
        callerType: 'safe',
        region: 'US'
      });
      expect(safeCallerID.success).toBe(true);
      if (safeCallerID.data) {
        var validation = _TestHelpers.SecurityTestHelper.validateCallerIDSafety(safeCallerID.data);
        expect(validation.isSafe).toBe(true);
      }
    }));
  });
});
var _default = exports.default = SecurityTestSuite;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfVGVzdEhlbHBlcnMiLCJyZXF1aXJlIiwiX1Rlc3RDb25zdGFudHMiLCJkZXNjcmliZSIsIm1vY2tGYWtlQ2FsbFNlcnZpY2UiLCJtb2NrVm9pY2VTeW50aGVzaXNTZXJ2aWNlIiwibW9ja0NhbGxlcklEU2VydmljZSIsImJlZm9yZUFsbCIsIlRlc3RTZXR1cEhlbHBlciIsInNldHVwVGVzdEVudmlyb25tZW50IiwiY3JlYXRlTW9ja0Zha2VDYWxsU2VydmljZSIsImNyZWF0ZU1vY2tWb2ljZVN5bnRoZXNpc1NlcnZpY2UiLCJjcmVhdGVNb2NrQ2FsbGVySURTZXJ2aWNlIiwiYWZ0ZXJBbGwiLCJjbGVhbnVwVGVzdEVudmlyb25tZW50IiwiYmVmb3JlRWFjaCIsImplc3QiLCJjbGVhckFsbE1vY2tzIiwidGVzdCIsIl9hc3luY1RvR2VuZXJhdG9yMiIsImRlZmF1bHQiLCJ4c3NJbnB1dHMiLCJmb3JFYWNoIiwiaW5wdXQiLCJpc1ZhbGlkIiwiU2VjdXJpdHlUZXN0SGVscGVyIiwidmFsaWRhdGVJbnB1dFNhbml0aXphdGlvbiIsImV4cGVjdCIsInRvQmUiLCJjYWxsZXJOYW1lUnVsZXMiLCJTRUNVUklUWV9SVUxFUyIsIklOUFVUX1ZBTElEQVRJT04iLCJ2YWxpZE5hbWVzIiwicmVwZWF0IiwiTUFYX0NBTExFUl9OQU1FX0xFTkdUSCIsIm5hbWUiLCJsZW5ndGgiLCJ0b0JlTGVzc1RoYW5PckVxdWFsIiwiYWxsb3dlZFBhdHRlcm4iLCJBTExPV0VEX0NIQVJBQ1RFUlMiLCJ2YWxpZElucHV0cyIsImludmFsaWRJbnB1dHMiLCJwcm9UaWVyVmFsaWRhdGlvbiIsIl9yZWY1IiwidXNlcklkIiwicmVxdWlyZWRGZWF0dXJlIiwibW9ja1Byb1RpZXJTZXJ2aWNlIiwidmFsaWRhdGVQcm9UaWVyQWNjZXNzIiwiZm4iLCJtb2NrSW1wbGVtZW50YXRpb24iLCJ1aWQiLCJQcm9taXNlIiwicmVzb2x2ZSIsImhhc0FjY2VzcyIsImNhbkFjY2Vzc0ZlYXR1cmUiLCJfeCIsIl94MiIsImFwcGx5IiwiYXJndW1lbnRzIiwicHJvVXNlclJlc3VsdCIsImZyZWVVc2VyUmVzdWx0IiwiYnlwYXNzQXR0ZW1wdHMiLCJtZXRob2QiLCJkYXRhIiwic3Vic2NyaXB0aW9uX3RpZXIiLCJhdHRlbXB0IiwiaXNWYWxpZFJlcXVlc3QiLCJ1c2VyX3RpZXIiLCJlbWVyZ2VuY3lOdW1iZXJzIiwibnVtYmVyIiwidmFsaWRhdGlvbiIsInZhbGlkYXRlUGhvbmVOdW1iZXIiLCJpc0VtZXJnZW5jeSIsInNhZmVDYWxsZXJJRCIsImdlbmVyYXRlU2FmZUNhbGxlcklEIiwiY2FsbGVyVHlwZSIsInJlZ2lvbiIsInN1Y2Nlc3MiLCJ2YWxpZGF0ZUNhbGxlcklEU2FmZXR5IiwiaXNTYWZlIiwiX2RlZmF1bHQiLCJleHBvcnRzIiwiU2VjdXJpdHlUZXN0U3VpdGUiXSwic291cmNlcyI6WyJTZWN1cml0eVRlc3RTdWl0ZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2VjdXJpdHkgVGVzdCBTdWl0ZSAtIFNlY3VyaXR5IGFuZCBJbnB1dCBWYWxpZGF0aW9uIFRlc3RzXG4gKiBDb21wcmVoZW5zaXZlIHNlY3VyaXR5IHRlc3RpbmcgZm9yIHRoZSBmYWtlIGNhbGwgbm90aWZpY2F0aW9uIHN5c3RlbVxuICovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBQbGF0Zm9ybSB9IGZyb20gJ3JlYWN0LW5hdGl2ZSc7XG5pbXBvcnQge1xuICAgIEZha2VDYWxsU2VydmljZSxcbiAgICB2b2ljZVN5bnRoZXNpc1NlcnZpY2UsXG4gICAgY2FsbGVySURTZXJ2aWNlXG59IGZyb20gJy4uL0Zha2VDYWxsU2VydmljZSc7XG5pbXBvcnQge1xuICAgIENhbGxFcnJvclR5cGUsXG4gICAgQ2FsbGVySW5mb1xufSBmcm9tICcuLi90eXBlcyc7XG5cbmltcG9ydCB7XG4gICAgTW9ja0NhbGxlckluZm9GYWN0b3J5LFxuICAgIE1vY2tGYWtlQ2FsbENvbmZpZ0ZhY3RvcnksXG4gICAgTW9ja0NhbGxTY2hlZHVsZUZhY3RvcnksXG4gICAgTW9ja1N0cmVzc1Rlc3RGYWN0b3J5XG59IGZyb20gJy4vTW9ja0ZhY3Rvcmllcyc7XG5cbmltcG9ydCB7XG4gICAgVGVzdFNldHVwSGVscGVyLFxuICAgIFNlY3VyaXR5VGVzdEhlbHBlcixcbiAgICBFcnJvclNpbXVsYXRpb25IZWxwZXJcbn0gZnJvbSAnLi9UZXN0SGVscGVycyc7XG5cbmltcG9ydCB7XG4gICAgU0VDVVJJVFlfUlVMRVMsXG4gICAgVEVTVF9USU1FT1VUUyxcbiAgICBFUlJPUl9UWVBFU1xufSBmcm9tICcuL1Rlc3RDb25zdGFudHMnO1xuXG5kZXNjcmliZSgnU2VjdXJpdHlUZXN0U3VpdGUnLCAoKSA9PiB7XG4gICAgbGV0IG1vY2tGYWtlQ2FsbFNlcnZpY2U6IGFueTtcbiAgICBsZXQgbW9ja1ZvaWNlU3ludGhlc2lzU2VydmljZTogYW55O1xuICAgIGxldCBtb2NrQ2FsbGVySURTZXJ2aWNlOiBhbnk7XG5cbiAgICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgICAgICBUZXN0U2V0dXBIZWxwZXIuc2V0dXBUZXN0RW52aXJvbm1lbnQoKTtcbiAgICAgICAgbW9ja0Zha2VDYWxsU2VydmljZSA9IFRlc3RTZXR1cEhlbHBlci5jcmVhdGVNb2NrRmFrZUNhbGxTZXJ2aWNlKCk7XG4gICAgICAgIG1vY2tWb2ljZVN5bnRoZXNpc1NlcnZpY2UgPSBUZXN0U2V0dXBIZWxwZXIuY3JlYXRlTW9ja1ZvaWNlU3ludGhlc2lzU2VydmljZSgpO1xuICAgICAgICBtb2NrQ2FsbGVySURTZXJ2aWNlID0gVGVzdFNldHVwSGVscGVyLmNyZWF0ZU1vY2tDYWxsZXJJRFNlcnZpY2UoKTtcbiAgICB9KTtcblxuICAgIGFmdGVyQWxsKCgpID0+IHtcbiAgICAgICAgVGVzdFNldHVwSGVscGVyLmNsZWFudXBUZXN0RW52aXJvbm1lbnQoKTtcbiAgICB9KTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICB9KTtcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBJTlBVVCBWQUxJREFUSU9OIEFORCBTQU5JVElaQVRJT04gVEVTVFNcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICBkZXNjcmliZSgnSW5wdXQgVmFsaWRhdGlvbiBhbmQgU2FuaXRpemF0aW9uIFRlc3RzJywgKCkgPT4ge1xuICAgICAgICB0ZXN0KCdzaG91bGQgZGV0ZWN0IFhTUyBhdHRhY2tzIGluIGNhbGxlciBuYW1lcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHhzc0lucHV0cyA9IFtcbiAgICAgICAgICAgICAgICAnPHNjcmlwdD5hbGVydChcInhzc1wiKTwvc2NyaXB0PicsXG4gICAgICAgICAgICAgICAgJ2phdmFzY3JpcHQ6YWxlcnQoXCJ4c3NcIiknLFxuICAgICAgICAgICAgICAgICc8aW1nIHNyYz14IG9uZXJyb3I9YWxlcnQoXCJ4c3NcIik+JyxcbiAgICAgICAgICAgICAgICAnXCI+PHNjcmlwdD5hbGVydChcInhzc1wiKTwvc2NyaXB0PidcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIHhzc0lucHV0cy5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpc1ZhbGlkID0gU2VjdXJpdHlUZXN0SGVscGVyLnZhbGlkYXRlSW5wdXRTYW5pdGl6YXRpb24oaW5wdXQsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBleHBlY3QoaXNWYWxpZCkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICB0ZXN0KCdzaG91bGQgdmFsaWRhdGUgY2FsbGVyIG5hbWUgbGVuZ3RoIGxpbWl0cycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNhbGxlck5hbWVSdWxlcyA9IFNFQ1VSSVRZX1JVTEVTLklOUFVUX1ZBTElEQVRJT047XG5cbiAgICAgICAgICAgIGNvbnN0IHZhbGlkTmFtZXMgPSBbXG4gICAgICAgICAgICAgICAgJ0pvaG4gU21pdGgnLFxuICAgICAgICAgICAgICAgICdEci4gU2FyYWggSm9obnNvbicsXG4gICAgICAgICAgICAgICAgJ0EnLnJlcGVhdChjYWxsZXJOYW1lUnVsZXMuTUFYX0NBTExFUl9OQU1FX0xFTkdUSClcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIHZhbGlkTmFtZXMuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgICAgICAgICBleHBlY3QobmFtZS5sZW5ndGgpLnRvQmVMZXNzVGhhbk9yRXF1YWwoY2FsbGVyTmFtZVJ1bGVzLk1BWF9DQUxMRVJfTkFNRV9MRU5HVEgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRlc3QoJ3Nob3VsZCBlbmZvcmNlIGNoYXJhY3RlciByZXN0cmljdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhbGxvd2VkUGF0dGVybiA9IFNFQ1VSSVRZX1JVTEVTLklOUFVUX1ZBTElEQVRJT04uQUxMT1dFRF9DSEFSQUNURVJTO1xuXG4gICAgICAgICAgICBjb25zdCB2YWxpZElucHV0cyA9IFtcbiAgICAgICAgICAgICAgICAnSm9obiBTbWl0aCcsXG4gICAgICAgICAgICAgICAgJ0RyLiBKb2huc29uIChBY21lIENvcnApJyxcbiAgICAgICAgICAgICAgICAnTWFyeS1KYW5lIE9cXCdCcmllbicsXG4gICAgICAgICAgICAgICAgJ0J1c2luZXNzX25hbWVfMTIzJ1xuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgY29uc3QgaW52YWxpZElucHV0cyA9IFtcbiAgICAgICAgICAgICAgICAnSm9obiA8c2NyaXB0PmFsZXJ0KFwieHNzXCIpPC9zY3JpcHQ+IFNtaXRoJyxcbiAgICAgICAgICAgICAgICAnVGVzdEAjJCVeJiooKScsXG4gICAgICAgICAgICAgICAgJ0pvaG58IFNtaXRoJ1xuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgdmFsaWRJbnB1dHMuZm9yRWFjaChpbnB1dCA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGFsbG93ZWRQYXR0ZXJuLnRlc3QoaW5wdXQpKS50b0JlKHRydWUpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGludmFsaWRJbnB1dHMuZm9yRWFjaChpbnB1dCA9PiB7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGFsbG93ZWRQYXR0ZXJuLnRlc3QoaW5wdXQpKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBQUk8gVElFUiBTRUNVUklUWSBURVNUU1xuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuICAgIGRlc2NyaWJlKCdQcm8gVGllciBTZWN1cml0eSBUZXN0cycsICgpID0+IHtcbiAgICAgICAgdGVzdCgnc2hvdWxkIHZhbGlkYXRlIHBybyB0aWVyIGFjY2VzcyBjb250cm9scycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHByb1RpZXJWYWxpZGF0aW9uID0gYXN5bmMgKHVzZXJJZDogc3RyaW5nLCByZXF1aXJlZEZlYXR1cmU6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1vY2tQcm9UaWVyU2VydmljZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdGVQcm9UaWVyQWNjZXNzOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCh1aWQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVpZCA9PT0gJ3Byb191c2VyXzEyMycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGhhc0FjY2VzcyA9IGF3YWl0IG1vY2tQcm9UaWVyU2VydmljZS52YWxpZGF0ZVByb1RpZXJBY2Nlc3ModXNlcklkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBoYXNBY2Nlc3MsXG4gICAgICAgICAgICAgICAgICAgIGNhbkFjY2Vzc0ZlYXR1cmU6IGhhc0FjY2Vzc1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjb25zdCBwcm9Vc2VyUmVzdWx0ID0gYXdhaXQgcHJvVGllclZhbGlkYXRpb24oJ3Byb191c2VyXzEyMycsICdmYWtlX2NhbGxzJyk7XG4gICAgICAgICAgICBleHBlY3QocHJvVXNlclJlc3VsdC5jYW5BY2Nlc3NGZWF0dXJlKS50b0JlKHRydWUpO1xuXG4gICAgICAgICAgICBjb25zdCBmcmVlVXNlclJlc3VsdCA9IGF3YWl0IHByb1RpZXJWYWxpZGF0aW9uKCdmcmVlX3VzZXJfNDU2JywgJ2Zha2VfY2FsbHMnKTtcbiAgICAgICAgICAgIGV4cGVjdChmcmVlVXNlclJlc3VsdC5jYW5BY2Nlc3NGZWF0dXJlKS50b0JlKGZhbHNlKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGVzdCgnc2hvdWxkIHByZXZlbnQgcHJvIHRpZXIgYnlwYXNzIGF0dGVtcHRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYnlwYXNzQXR0ZW1wdHMgPSBbXG4gICAgICAgICAgICAgICAgeyBtZXRob2Q6ICdoZWFkZXJfbWFuaXB1bGF0aW9uJywgZGF0YTogeyAnWC1Vc2VyLVRpZXInOiAncHJvJyB9IH0sXG4gICAgICAgICAgICAgICAgeyBtZXRob2Q6ICdjb29raWVfbWFuaXB1bGF0aW9uJywgZGF0YTogeyAndXNlcl90aWVyJzogJ3BybycgfSB9LFxuICAgICAgICAgICAgICAgIHsgbWV0aG9kOiAnbG9jYWxfc3RvcmFnZV9vdmVycmlkZScsIGRhdGE6IHsgc3Vic2NyaXB0aW9uX3RpZXI6ICdwcm8nIH0gfVxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgYnlwYXNzQXR0ZW1wdHMuZm9yRWFjaChhdHRlbXB0ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpc1ZhbGlkUmVxdWVzdCA9IChkYXRhOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGFbJ1gtVXNlci1UaWVyJ10gPT09ICdwcm8nKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLnVzZXJfdGllciA9PT0gJ3BybycpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IGlzVmFsaWQgPSBpc1ZhbGlkUmVxdWVzdChhdHRlbXB0LmRhdGEpO1xuICAgICAgICAgICAgICAgIGV4cGVjdChpc1ZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAgICAvLyBDQUxMRVIgSUQgU0FGRVRZIFZBTElEQVRJT04gVEVTVFNcbiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbiAgICBkZXNjcmliZSgnQ2FsbGVyIElEIFNhZmV0eSBWYWxpZGF0aW9uIFRlc3RzJywgKCkgPT4ge1xuICAgICAgICB0ZXN0KCdzaG91bGQgdmFsaWRhdGUgZW1lcmdlbmN5IG51bWJlciBwcm90ZWN0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZW1lcmdlbmN5TnVtYmVycyA9IFsnOTExJywgJzExMicsICc5OTknLCAnMDAwJ107XG5cbiAgICAgICAgICAgIGVtZXJnZW5jeU51bWJlcnMuZm9yRWFjaChudW1iZXIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSBtb2NrQ2FsbGVySURTZXJ2aWNlLnZhbGlkYXRlUGhvbmVOdW1iZXIobnVtYmVyKTtcbiAgICAgICAgICAgICAgICBleHBlY3QodmFsaWRhdGlvbi5pc0VtZXJnZW5jeSkudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICB0ZXN0KCdzaG91bGQgZ2VuZXJhdGUgc2FmZSBjYWxsZXIgSURzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc2FmZUNhbGxlcklEID0gYXdhaXQgbW9ja0NhbGxlcklEU2VydmljZS5nZW5lcmF0ZVNhZmVDYWxsZXJJRCh7XG4gICAgICAgICAgICAgICAgY2FsbGVyVHlwZTogJ3NhZmUnLFxuICAgICAgICAgICAgICAgIHJlZ2lvbjogJ1VTJ1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChzYWZlQ2FsbGVySUQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgICAgICAgIGlmIChzYWZlQ2FsbGVySUQuZGF0YSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSBTZWN1cml0eVRlc3RIZWxwZXIudmFsaWRhdGVDYWxsZXJJRFNhZmV0eShzYWZlQ2FsbGVySUQuZGF0YSk7XG4gICAgICAgICAgICAgICAgZXhwZWN0KHZhbGlkYXRpb24uaXNTYWZlKS50b0JlKHRydWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCBTZWN1cml0eVRlc3RTdWl0ZTsiXSwibWFwcGluZ3MiOiI7Ozs7OztBQXdCQSxJ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