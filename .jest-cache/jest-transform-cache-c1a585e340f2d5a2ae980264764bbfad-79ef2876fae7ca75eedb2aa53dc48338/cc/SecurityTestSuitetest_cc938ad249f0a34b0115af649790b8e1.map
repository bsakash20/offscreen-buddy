{"version":3,"names":["_TestHelpers","require","_TestConstants","describe","mockFakeCallService","mockVoiceSynthesisService","mockCallerIDService","beforeAll","TestSetupHelper","setupTestEnvironment","createMockFakeCallService","createMockVoiceSynthesisService","createMockCallerIDService","afterAll","cleanupTestEnvironment","beforeEach","jest","clearAllMocks","test","_asyncToGenerator2","default","xssInputs","forEach","input","isValid","SecurityTestHelper","validateInputSanitization","expect","toBe","callerNameRules","SECURITY_RULES","INPUT_VALIDATION","validNames","repeat","MAX_CALLER_NAME_LENGTH","name","length","toBeLessThanOrEqual","allowedPattern","ALLOWED_CHARACTERS","validInputs","invalidInputs","proTierValidation","_ref5","userId","requiredFeature","mockProTierService","validateProTierAccess","fn","mockImplementation","uid","Promise","resolve","hasAccess","canAccessFeature","_x","_x2","apply","arguments","proUserResult","freeUserResult","bypassAttempts","method","data","subscription_tier","attempt","isValidRequest","user_tier","emergencyNumbers","number","validation","validatePhoneNumber","isEmergency","safeCallerID","generateSafeCallerID","callerType","region","success","validateCallerIDSafety","isSafe","_default","exports","SecurityTestSuite"],"sources":["SecurityTestSuite.test.ts"],"sourcesContent":["/**\n * Security Test Suite - Security and Input Validation Tests\n * Comprehensive security testing for the fake call notification system\n */\n\nimport React from 'react';\nimport { Platform } from 'react-native';\nimport {\n    FakeCallService,\n    voiceSynthesisService,\n    callerIDService\n} from '../FakeCallService';\nimport {\n    CallErrorType,\n    CallerInfo\n} from '../types';\n\nimport {\n    MockCallerInfoFactory,\n    MockFakeCallConfigFactory,\n    MockCallScheduleFactory,\n    MockStressTestFactory\n} from './MockFactories';\n\nimport {\n    TestSetupHelper,\n    SecurityTestHelper,\n    ErrorSimulationHelper\n} from './TestHelpers';\n\nimport {\n    SECURITY_RULES,\n    TEST_TIMEOUTS,\n    ERROR_TYPES\n} from './TestConstants';\n\ndescribe('SecurityTestSuite', () => {\n    let mockFakeCallService: any;\n    let mockVoiceSynthesisService: any;\n    let mockCallerIDService: any;\n\n    beforeAll(() => {\n        TestSetupHelper.setupTestEnvironment();\n        mockFakeCallService = TestSetupHelper.createMockFakeCallService();\n        mockVoiceSynthesisService = TestSetupHelper.createMockVoiceSynthesisService();\n        mockCallerIDService = TestSetupHelper.createMockCallerIDService();\n    });\n\n    afterAll(() => {\n        TestSetupHelper.cleanupTestEnvironment();\n    });\n\n    beforeEach(() => {\n        jest.clearAllMocks();\n    });\n\n    // ===========================================\n    // INPUT VALIDATION AND SANITIZATION TESTS\n    // ===========================================\n\n    describe('Input Validation and Sanitization Tests', () => {\n        test('should detect XSS attacks in caller names', async () => {\n            const xssInputs = [\n                '<script>alert(\"xss\")</script>',\n                'javascript:alert(\"xss\")',\n                '<img src=x onerror=alert(\"xss\")>',\n                '\"><script>alert(\"xss\")</script>'\n            ];\n\n            xssInputs.forEach(input => {\n                const isValid = SecurityTestHelper.validateInputSanitization(input, false);\n                expect(isValid).toBe(true);\n            });\n        });\n\n        test('should validate caller name length limits', async () => {\n            const callerNameRules = SECURITY_RULES.INPUT_VALIDATION;\n\n            const validNames = [\n                'John Smith',\n                'Dr. Sarah Johnson',\n                'A'.repeat(callerNameRules.MAX_CALLER_NAME_LENGTH)\n            ];\n\n            validNames.forEach(name => {\n                expect(name.length).toBeLessThanOrEqual(callerNameRules.MAX_CALLER_NAME_LENGTH);\n            });\n        });\n\n        test('should enforce character restrictions', async () => {\n            const allowedPattern = SECURITY_RULES.INPUT_VALIDATION.ALLOWED_CHARACTERS;\n\n            const validInputs = [\n                'John Smith',\n                'Dr. Johnson (Acme Corp)',\n                'Mary-Jane O\\'Brien',\n                'Business_name_123'\n            ];\n\n            const invalidInputs = [\n                'John <script>alert(\"xss\")</script> Smith',\n                'Test@#$%^&*()',\n                'John| Smith'\n            ];\n\n            validInputs.forEach(input => {\n                expect(allowedPattern.test(input)).toBe(true);\n            });\n\n            invalidInputs.forEach(input => {\n                expect(allowedPattern.test(input)).toBe(false);\n            });\n        });\n    });\n\n    // ===========================================\n    // PRO TIER SECURITY TESTS\n    // ===========================================\n\n    describe('Pro Tier Security Tests', () => {\n        test('should validate pro tier access controls', async () => {\n            const proTierValidation = async (userId: string, requiredFeature: string) => {\n                const mockProTierService = {\n                    validateProTierAccess: jest.fn().mockImplementation((uid: string) => {\n                        if (uid === 'pro_user_123') {\n                            return Promise.resolve(true);\n                        }\n                        return Promise.resolve(false);\n                    })\n                };\n\n                const hasAccess = await mockProTierService.validateProTierAccess(userId);\n                return {\n                    hasAccess,\n                    canAccessFeature: hasAccess\n                };\n            };\n\n            const proUserResult = await proTierValidation('pro_user_123', 'fake_calls');\n            expect(proUserResult.canAccessFeature).toBe(true);\n\n            const freeUserResult = await proTierValidation('free_user_456', 'fake_calls');\n            expect(freeUserResult.canAccessFeature).toBe(false);\n        });\n\n        test('should prevent pro tier bypass attempts', async () => {\n            const bypassAttempts = [\n                { method: 'header_manipulation', data: { 'X-User-Tier': 'pro' } },\n                { method: 'cookie_manipulation', data: { 'user_tier': 'pro' } },\n                { method: 'local_storage_override', data: { subscription_tier: 'pro' } }\n            ];\n\n            bypassAttempts.forEach(attempt => {\n                const isValidRequest = (data: any) => {\n                    if (data['X-User-Tier'] === 'pro') return false;\n                    if (data.user_tier === 'pro') return false;\n                    return true;\n                };\n\n                const isValid = isValidRequest(attempt.data);\n                expect(isValid).toBe(false);\n            });\n        });\n    });\n\n    // ===========================================\n    // CALLER ID SAFETY VALIDATION TESTS\n    // ===========================================\n\n    describe('Caller ID Safety Validation Tests', () => {\n        test('should validate emergency number protection', async () => {\n            const emergencyNumbers = ['911', '112', '999', '000'];\n\n            emergencyNumbers.forEach(number => {\n                const validation = mockCallerIDService.validatePhoneNumber(number);\n                expect(validation.isEmergency).toBe(true);\n            });\n        });\n\n        test('should generate safe caller IDs', async () => {\n            const safeCallerID = await mockCallerIDService.generateSafeCallerID({\n                callerType: 'safe',\n                region: 'US'\n            });\n\n            expect(safeCallerID.success).toBe(true);\n            if (safeCallerID.data) {\n                const validation = SecurityTestHelper.validateCallerIDSafety(safeCallerID.data);\n                expect(validation.isSafe).toBe(true);\n            }\n        });\n    });\n});\n\nexport default SecurityTestSuite;"],"mappings":"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","ignoreList":[]}